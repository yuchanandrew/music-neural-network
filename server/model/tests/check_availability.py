from dotenv import load_dotenv
import os
import spotipy
from spotipy.oauth2 import SpotifyOAuth
import json
import numpy as np
import time

load_dotenv()

spotify_client = os.getenv("SPOTIFY_CLIENT")
spotify_secret = os.getenv("SPOTIFY_SECRET")
spotify_redirect_uri = "http://127.0.0.1:5000/callback"

sp = spotipy.Spotify(
    auth_manager=SpotifyOAuth(
        client_id=spotify_client,
        client_secret=spotify_secret,
        redirect_uri=spotify_redirect_uri,
    )
)

json_path = r"server\model\unclean_dataset.json"

with open(json_path, mode="r") as f:
    data = json.load(f)
    print("Json loaded")

# test = sp.track(track_id="3Fk2PVwV7DMGfaTjKliv9c", market="US")
# print(test.get("is_playable"), test.get("restrictions"))

bad_eggs = []
count = 0

# from itertools import islice


# def chunks(lst, n):
#     for i in range(0, len(lst), n):
#         yield lst[i : i + n]


# bad_eggs = []
# processed = 0

# for batch in chunks([i["spotify_id"] for i in data], 50):
#     tracks = sp.tracks(batch, market="US")["tracks"]

#     for spotify_id, track in zip(batch, tracks):
#         if not track or track.get("is_playable") is not True:
#             bad_eggs.append(spotify_id)

#         processed += 1

#         if processed % 1000 == 0:
#             print(f"Progress: {processed} / 12k")

#     time.sleep(0.2)

# print(f"Bad eggs: {bad_eggs}")

unavailable = [
    "2Ur2dqDROT9msE41Xmfpzu",
    "4CZLymvdspb9UeGuzxpsCe",
    "53Chgqu2TN0wlPw9EeJjSb",
    "63CxtvIwhaiLyyxFF2eIRq",
    "5hykhKQH1EL5jW2UYZ615w",
    "39cC24YXbIj52y0i7BYeLy",
    "07UjvOy6A5PBQS6DEDWXe6",
    "5zfIeZtND9g7SyaYlu5CPd",
    "5Yl623nUsrMf5QBe5dvzb3",
    "6uhIPnJfybl3JhslSy4FWp",
    "2XTPWq6MPWmTMj1DTtkuCH",
    "1rrybhjLvLkt6OEBHpmObY",
    "5Mon68O1ubGEQPNIdAbqur",
    "5cdQqZB9GS2JAcwncFLabF",
    "5CqBXjdgUyYTXNSZliOksA",
    "1yGdDVCH0xg9Zp80Cc4Bsk",
    "6aMf7zellt7UckaMMjFSOk",
    "1qpo7EPyUl0WL9oKAK2hYm",
    "1TCxBq17sCGddvfkPnO4QO",
    "0iQkeXwp7V8Y6wWYSsn6RY",
    "22pGUXnkdIOCXtb0kIclnq",
    "4zciNpj3c6qIfiikaihQnO",
    "19mG989UMRSO457IjWwnpv",
    "15F2RHxcNK0n6UFiFg0Cot",
    "2uaoE3g1d0zmQtkGzg6MHu",
    "6HpBosT0jrK5VIyhC7onlT",
    "42gvARMLFV83S2e7MtqNWd",
    "5iDcILPItZCQiIpy6CblIk",
    "3R95FwF2Dge6BQ7FG5ZRYT",
    "6v3lZvwCQp4TcBz6KATAMF",
    "0Lktdb6Ln1oxbOFtFkFjjP",
    "2avjIAshWtZ885AoPZeuOW",
    "2W7jrW5Dgh2M1zAaDdLbbz",
    "73fIVFOx7sgWlh47NE8Lqa",
    "2aOB4t49DS5iWWW4CcDCkg",
    "2G4nWceUFlXtEy3F16tBDN",
    "4VJIQj722vIGQukIJQ6hQp",
    "13nHzOfCOh9eLHR1alAg5K",
    "5oeVdxfoQ6V5Av8o2a9yj6",
    "3K4Seu9YlwQAEqwQ0tYdSf",
    "2tLvBR5PbDi3lzsZPxQNJ2",
    "24WWmpzDiXiWCXuNvippRc",
    "7L1E5vpVwJzAhNaxiNC6hy",
    "6wksOp8zR2QHd6jzoalxa8",
    "2HFP5LkcsWLO6GmHaZ2JkP",
    "0qLfKglZdKheWDjGE5mMbP",
    "2cOZL5oubw5lsOe7MpejnH",
    "6xPIcZ6ASbvvnt0y22TGjP",
    "33BDfo0JrRRDF8mTNariOD",
    "4fLCNs3ufbdAX7tKyWSePx",
    "4bGK2heccgIlo0bu3TQ4L7",
    "2FOqiE6PHJwF0z0MhOAzPD",
    "6HhQRF1JIzpkrWzbEXrpdn",
    "5R8YGjivMvVHUSMCqyO6yR",
    "2cNbGmDcwRW2EqCmUNrnM7",
    "39Iv2td1ee4BB21R5PY4xU",
    "08e6U2QpbkKEeguPxKPqvZ",
    "3Nc6Cluv4HdHNNX9J4kKoC",
    "7k5CcfEf2v1WnT2Th3eiKL",
    "5op9T6FYqUYxv4DOroIA6L",
    "2L4lYxLsgqzDvL7L2h4Hz6",
    "6J312sM5ez2xVn7h7NeBjX",
    "7igfYEefts84DzKb9bb1VB",
    "2NjQnBebeW4VNEZx2R0Snn",
    "5tg0rEcXRWpLbqyshPfTyM",
    "2yPIj6y6KSDpIFPpD7AX3s",
    "1ie3AngZpYHe77B4bbg2oP",
    "5bcDTUYoaXIJuIepbysX7Q",
    "2myc9XPWwRcEyOSGGT1SSC",
    "146s43YYh0yabU5yAn4Rz9",
    "62hHF266kPe7hlbsyFhWrP",
    "0YzMEu5sGNX0JKr9mdBtzd",
    "5Lm8Tc6LyuO0Q08O7cNZ0O",
    "6Czpq4cmeuv3sc5K9281or",
    "0OYIQsYaf2pfwA0I8L2EXw",
    "0YzMEu5sGNX0JKr9mdBtzd",
    "4a6ziAbdakNcfZavBEvaP6",
    "6FIgO4W0JJeaY7myF1SEwP",
    "1vH1pz7xJvCJLVOK3CHQQk",
    "4bfdDWaFNxCiVcxj2tMJRF",
    "2ODrFsYi3f43uwl6nglg6k",
    "6gCvv1WKMAgNZf8Bqda7qU",
    "2nYt8Ulki4mGYJs49JefBD",
    "2wbSMK5C2INoOugIBTjIK9",
    "6P6rpA3BHfRSx90X8BBLYP",
    "11Js4EcvYr8jjrVfUxAACN",
    "5aKfxgvlxebcZ33AD2XNvM",
    "1xovVgKK8Wv6avz02cYBGI",
    "4kHSL04N2lFOEteutHmOaz",
    "3inZiiGfxEXmFMvWaDwEsN",
    "3wz8q7Sds7Q6XaXEAkDu3z",
    "7J1fUVyDp7HRFZRF6pDUy2",
    "4SqYEq7cYJp3mFl54CZf3p",
    "6GftjPUQwJEVAXLPHVnuz4",
    "33OTCoIaIbxSLAne5iPbtr",
    "3FQ0CN0SxlTLpL3e3Pao10",
    "4uwEUukN5YrhyBujgsMQ4E",
    "0fdjtXM1EhORUd4039PNNo",
    "0e1BAbl6ABcgZD1NeLN98E",
    "0gazxaX2ej0gI9TUOUwIIu",
    "0ws4hp1O59KJFTvsU1b9ts",
    "0FLl4KeFOp4lB7hE55kSCo",
    "7kNa9vOsPOkTdKUROzxaGc",
    "7EHhp61jW1vDTvHyBLq5XY",
    "7H9UvLgBLEtPTWhUI8oDbE",
    "4xfMcbFOvIOOnJJweaHblJ",
    "6EWrxDhpqDQPPckRpOJNC3",
    "4FcPLa4nWnG0jwxcqu1Yc2",
    "3chTJO52DoGpa7I1Xj4K50",
    "4IPheii4fOTJDumpe8p6LT",
    "2QD7cLcAGt592owNqQLoj1",
    "0f71vcw4CJs22g2j5RFJy8",
    "0G5IBiOs4duR0699WyOEpC",
    "4HZugGmERAQgrsgdEq0Qwi",
    "3tZ5zefUQmWyhkYVgrzh0e",
    "4OqsaQjSR0MLpeQtvZulQO",
    "7D6WtLJm0GQNqWkce6usem",
    "18sGpiKD5AE8GdEP9BJoj6",
    "087fVMVab92lfru2FaVjxI",
    "1DqAcuDl4BnP8I6w8U8QGX",
    "01sJV2YhUjtr4zkCns7DXc",
    "46Fa4N8sPXUYuUQxGophnp",
    "2DkgZaFuQaq7gR3BNG2jjx",
    "32MtBVDzNlSmNeKqGlf3Yt",
    "2Pg0DqVYniOHUJRmS0ysEP",
    "6eKTN2CjJ5wCTd1ggYcgmS",
    "6qsmZkycrPcHTcQedV2rQu",
    "3El5dvihD6EEvKQ9Y41fUx",
    "3WHXeABZWyTa6eGxeHtA7z",
    "6Mf9mqm3kyvjf8DuFgdy8h",
    "2tifYa1N1sWoWlpV7D8haA",
    "7hQdVwGmAev6ASlsKlwbqA",
    "7f6KtPWHbFIn8WDse2sayo",
    "7JxmjUafnXB9p0I1ssvh7Y",
    "747NOacDKr49RpZwzrKSNX",
    "5VT3K0q3h6POxYfImossPD",
    "3luk9d6Gc0QngNITLKfnh7",
    "1XT0SXFYoRyp5nXYcRSPsU",
    "3rzxjg1QQ1mgKV89HN1uPN",
    "2im5bOZMHD1rnwlFEaVEBT",
    "0pTYjC0AyjrXIiVFZTT495",
    "0J5F1neXeWa5nwOxmIpzV4",
    "1WIq3oAgCoL1fILqUZilSH",
    "7eU6OYpuSDytJN38fmMt0l",
    "7AaLzBVUHugWGmT1nDjjzd",
    "33wsGfjtiUsNVACtOef34g",
    "5BXK6ZERP3MT4JXjRm8lHB",
    "2ffhWTneVV7x3hctg87lvC",
    "5achKyrdg1ZCti2Eiyl6aT",
    "0x6o7Iv40llGIDdrlFAkAW",
    "1F8iqdCXjX0EoUfs6YRmHc",
    "1CJdb8VtMVUJ8mVPca5MQy",
    "3GwBZ4q31FfHgnQCtSfELP",
    "2AtVrw5aGqReWm13J6Ne30",
    "65a8EzSmu1S92zObGSvMMc",
    "0NRwolBipnp5l7yAtCyfFC",
    "0hRECUb42yXfkSOS9Un1qf",
    "1NOVwIJGUuV6huh4sKVISd",
    "0VbXMd7vf40eA77Fqb2g4I",
    "28D0Hfi6x9zAeGr1sDYBkb",
    "0qq6OyuqQBXKxo0SQmUI3L",
    "6PwFp1K7RwNv3QaiODZ7hb",
    "3TwMidsqKWXD5bBcityXbp",
    "67rLkvNELkXfa64EdpYT1A",
    "5RTK8I2iIrLI0znbSTwLrd",
    "7uMLqeuIzJULGU1z9Q4su9",
    "6lpsuFdeVg4e3ss3A416uQ",
    "3qRaWZ0RcQrefPPWkNqg4e",
    "73kv2vlZwejD7FvGF87ECz",
    "5nytGZfs3wK9TBQ2oZpUhM",
    "1JAMD1GFDz0S8jwJbGVsmr",
    "6wc8Zk3FkVoZLJKxrhPM1J",
    "42PzQXOvLxqeQzHC4H3nDL",
    "5s0j0XAPE33X4dAb278V6b",
    "7ttUquEnM2VDVHvAvcnwxC",
    "2bfFuilfUKLsfCzOh2QDWk",
    "3WoRENpchrAgR0MpLNPs4G",
    "3rw2SRx51EWVwcgLdDSBTz",
    "4K3NSGfQcIb7fMwU89T4nD",
    "3kGD2gSbiXhbRvE9VDBmbk",
    "6xmSbHAUsVnwIjNVsqeLOz",
    "3Dd7TUT2mTp4KEfM9waj6x",
    "3EmdZw5dOZdd2JH83ldGrF",
    "6eEyHKfAhHNQcpyncrLaer",
    "5n3hizNPyiJQ9ytpf385sw",
    "5vifGqmq6MAzwIonkQJtqC",
    "0LuL3b0muJF6so3CPOfy8Z",
    "5WxwRwUQ4R4L46VEm3213y",
    "1AePjgLLtzF0abbfcgYdLI",
    "3MBsQgR0v9iA9wPD1ll8Dc",
    "0zUzw1TelsSOOhM7S6Sc0l",
    "5rDTGIQHCuVlBf47HbIwc0",
    "6Pn31vMLnB9FHOzZLg8pV3",
    "2Ql3b1ekvOo7lr09rhLD42",
    "7k9Ec6LGMJ6wadOJ1pRGww",
    "0aVo0qxnQsBZ0LY9YHYkVd",
    "3PI57NOz6MAyoow6nvkyPO",
    "7CLO74VqYXdBn1nyeANxBR",
    "6CsK6gyd6xEz8t9wD2fWok",
    "5mYo0UgRiiiislsey0dJ87",
    "4vV84PJRsxHu96VikxsmwJ",
    "6JK1boSXRi640H5OkGCIsY",
    "4OseEmkXDF1AnXTZoeodl5",
    "0lQuATP58PoaHtZG0bibXp",
    "2Sdkwd9ptjUCcYR9uPECmx",
    "2RzUQCQiPoTU54rMDXaOeI",
    "61kwvNd5kXYVxJTfE2eZd3",
    "5MJdMFB6bBzovPwfX9kIBY",
    "1ZqkazDr89QfYqq4ONXW74",
    "2vAXRUPu5jlwSWS8irMW04",
    "4uEcrU3KBUda1qrHZtR6Nk",
    "47MeoTDDJnZXnQKBJdafuC",
    "6D9XRhbDz4wkr5OspC4WF1",
    "5mqXZSWFhmnBQJ7EUNKXjF",
    "1pWHa2mQOXBPIi9IUuRi99",
    "4RDefDJN7kTBj9oxMQ50Ys",
    "4Ds8M9h3GYYCmHcCOBK9L7",
    "6hnsqlzBGwnwPhKP4PhUk4",
    "3o1LDdgWLfkn20LFVTuNql",
    "0zP4lRSovPeAnKfhc7bgrg",
    "543slYFcd803hF1t2upxKx",
    "63VyfnX8yRAVYNdgaiDLPv",
    "54UKJ1LNkvl6R3uHyPrrYn",
    "1Btn0aYsJBDyyYPQ1rXLn1",
    "6lTqyvbXsY0d6AgOvLtS0S",
    "6fTjWhg68tOSY9rv85PMSe",
    "4ZLgtqLgATp9B7jBrmQHex",
    "5SJ6MOVzxzWjF8kb9dc5Xy",
    "0pBvdviTzV3youqvFasEDX",
    "4fJ9jyugWXqJEgnDWX0xGT",
    "3QvtXiPD5vlfWrb9FF42PB",
    "0Gz2ihCrX9Fxmd3wB7GL4n",
    "4lsn6g3yQNNlXLaNK05nC6",
    "4vzJrzOtBQM83ZSQQYpD23",
    "1a2ZzUlGQHH06cj3feskim",
    "6Or0dx7Bqf46cPLwoEC6lO",
    "6uw7IMROUAN1fTFGL0fFd1",
    "3JAk32cFxFYWFMcK2BcA5O",
    "7aPrAazka89C1uInIDpLmd",
    "0b1Cpu2geO7om7aW066a7K",
    "7BRzDimx8IekY3iDIB1iDZ",
    "35kFxXS2CKjmIHzCBPKNm8",
    "3ONgBP3uODsZmGeigIYIgM",
    "7LiK6skY0fnpATx8I4Mnep",
    "0GsaShZVw9qiwNCW1BhLOL",
    "26OadpKXQypPL7P9DcSo49",
    "02grzE8WSF5PVJHoTnzTWa",
    "6IC3FtubtkkUsFrIh8T0EZ",
    "1f0XXJ0te04zRBaWnhEC3m",
    "7yFdimb9v79QNXC3I1psBh",
    "1lB7tNAc1HztxoguTxXe8M",
    "3ciSZpBdPdnbc6yRxHyDts",
    "5AP217u2SGYHM4DvnPjauO",
    "351E3TZyg9pwPh3jTZTHJB",
    "4gD01Arnn01uBxVgYCdeot",
    "3xCbZZqeMoL5conl3vO6aJ",
    "1lu3CtKqfbCdrIyzVrXImk",
    "1gk84wJFXy2Do6HalpKhxL",
    "0jf6IH74ldS5WIW8rMwyCf",
    "0NBf2iFTPE0oc9gbYHOmiB",
    "1rZ0E8RVOzAf09WnxS9qk4",
    "5gq5W88rER1bZ7zezLpGOH",
    "7y1gPVagvy9OAcs9xAVMnP",
    "6Zf5LLSpljdDUT9B4y02yl",
    "6qnyL4NWLOl0jFLNhzygop",
    "3IT3koPwpE5aLo3THpLYgk",
    "23QjwjIx1ycvegHxWU6U1G",
    "1J1ddIqD7qGj0TboajToQe",
    "0ioFIQXbTUaliQpsJyX4zN",
    "3ngv3P3UGo2Bm913XHfFnf",
    "4wUgOvgVwT9TpXtejbMui3",
    "1iUnhEgrBjppyk1Lzf3sX3",
    "5jAbXsbYk7ZufSShbIWyym",
    "3QvShfzxAtsZ7QTXiEguCI",
    "4hnR3vkREdoAIk5AMIp1E8",
    "7Awt7AD8gT7FYes6eUkpa7",
    "3V9T9JgS72byucjzuosEck",
    "2u2N2p2dGR6uZfwgjG6CMI",
    "3hliocQ1LpvBZ37z3z7fqe",
    "0dtZoIOK7OrBYgVrLBedYr",
    "7umP1FaR5Alt4TyuQz6y3z",
    "1AkWIJ2HbVyTyjYZUJcrFc",
    "7H5AlHvNK6H2KADlv4G9W4",
    "1nYwzQWhsu7Me9lD7RmIWA",
    "71HLAUqyaeaUBsMGVCLde9",
    "5VUe8pjwyorTVE16r2w3vO",
    "6bI3ToxEeWYH4q5OwCRIpB",
    "4x25EYdjb2jt11MEz8thCG",
    "6LsqHn9fKmN50WOaAMJnT0",
    "4OGGM4p6BsX6QZjB2o5Tby",
    "132b5euv8RgFlNJHJnikKK",
    "22bSOXSLR9dsBsxZTp5c12",
    "5z9JcU2xVY9cLpnXhwkQLX",
    "2Dn1Jm10LZzzy3xrdbrarT",
    "12W4gurjLpjuyRlgJw1g0e",
    "28KGvCo5JAWXmXDryhTEFy",
    "27QXlT79qaVYKWaci3p2Qr",
    "70XN2yJKsxVQn27Px6WWwJ",
    "4yy1CRqlUGcKjtG3mAV7YH",
    "11DPvXpOu4JVENljhXTxBM",
    "56gR4xuLQ1yIkKR3uftjqQ",
    "1LCSbLqEOK1ET2GPvrmJTJ",
    "75TDqjpt6Lr52T4YoUByVz",
    "1NLpH6o1eU4VVwqw49hcC6",
    "0sR89MRq87myGAyVKKlvid",
    "6CGhArjFha9P2cN8mpTqfS",
    "1fL7eZzARHZkeHs4SnqcWI",
    "2nHMeRYAq8VTH5Ro5Taiq0",
    "6s5BwPPzz4bdY5aUHWzqAE",
    "5UFQNu7wORWYif93KDlA1R",
]

data = [item for item in data if item.get("spotify_id") not in unavailable]

print("Updated!")

new_json_path = r"server\model\available_unclean_dataset.json"
with open(new_json_path, mode="w") as f:
    json.dump(data, f, indent=2)